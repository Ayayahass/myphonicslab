<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin | My Phonics Lab</title>
  <link rel="stylesheet" href="style.css"/>
  <style>body{visibility:hidden}</style>
  <script>
    (function(){
      const role = localStorage.getItem('role');
      if (role !== 'admin') { location.replace('login.html'); }
      else { document.addEventListener('DOMContentLoaded',()=>{ document.body.style.visibility='visible'; }); }
    })();
  </script>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <h1>Admin Panel</h1>
      <div class="right">
        <a class="link" href="index.html">Student View</a>
        <button class="link" onclick="logout()">Logout</button>
      </div>
    </header>

    <!-- إعدادات GitHub -->
    <section class="panel">
      <h3>GitHub Repository Settings</h3>
      <div class="grid2">
        <label>Owner/User
          <input id="ghOwner" placeholder="مثال: your-username">
        </label>
        <label>Repo
          <input id="ghRepo" placeholder="مثال: my-phonics-lab">
        </label>
        <label>Branch
          <input id="ghBranch" value="main">
        </label>
        <label>GitHub Token (PAT)
          <input id="ghToken" type="password" placeholder="ghp_***">
        </label>
      </div>
      <label class="row"><input id="rememberCfg" type="checkbox"> تذكّر الإعدادات (LocalStorage)</label>
      <button onclick="saveGhConfig()">Save Settings</button>
    </section>

    <!-- رافع الصوت/الصورة/الفيديو -->
    <section class="panel">
      <h3>Upload Media</h3>

      <div class="uploader">
        <h4>Upload Letter Sound</h4>
        <p class="tiny muted">اكتبي اسم الحرف (a–z) وسيتم الرفع إلى <code>sounds/&lt;letter&gt;.mp3</code></p>
        <input id="letterName" maxlength="1" placeholder="a">
        <input id="letterFile" type="file" accept="audio/*">
        <button onclick="uploadLetter()">Upload Sound</button>
      </div>

      <hr/>

      <div class="uploader">
        <h4>Upload Image</h4>
        <input id="imgFile" type="file" accept="image/*">
        <input id="imgName" placeholder="images/example.png">
        <button onclick="uploadGeneric('imgFile','imgName')">Upload Image</button>
      </div>

      <div class="uploader">
        <h4>Upload Video</h4>
        <input id="vidFile" type="file" accept="video/*">
        <input id="vidName" placeholder="videos/intro.mp4">
        <button onclick="uploadGeneric('vidFile','vidName')">Upload Video</button>
      </div>
    </section>

    <section class="panel">
      <h3>Notes</h3>
      <ul class="muted">
        <li>لن نُخزّن الـToken إلا إذا اخترتِ “تذكّر الإعدادات”.</li>
        <li>إن كان الملف موجودًا، سنحدّثه تلقائيًا (commit مع رسالة مناسبة).</li>
      </ul>
    </section>
  </div>

  <script src="app.js"></script>
  <script>
    loadGhConfig(); // تحميل الإعدادات المخزنة إن وجدت

    async function uploadLetter(){
      const letter = document.getElementById('letterName').value.toLowerCase();
      const file = document.getElementById('letterFile').files[0];
      if(!letter || !/^[a-z]$/.test(letter) || !file) return alert('أدخلي حرفًا صحيحًا واخترِي ملفًا.');
      await uploadToGithub(file, `sounds/${letter}.mp3`, `Add/Update sound for ${letter}`);
    }

    async function uploadGeneric(fileInputId, pathInputId){
      const file = document.getElementById(fileInputId).files[0];
      const path = document.getElementById(pathInputId).value.trim();
      if(!file || !path) return alert('اختاري ملفًا وحددي المسار (مثل images/x.png)');
      await uploadToGithub(file, path, `Add/Update ${path}`);
    }
  </script>
</body>
</html>
